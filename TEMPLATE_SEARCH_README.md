# Template Search MCP Tools

Добавлены новые инструменты для поиска шаблонов (meta entities) в Onto MCP Server.

## Новые MCP инструменты

### 1. `search_templates`

Поиск шаблонов (meta entities) по имени в реалмах Onto.

**Параметры:**
- `name_part` (обязательный) - часть имени для поиска
- `realm_id` (необязательный) - ID реалма для поиска. Если не указан, используется первый доступный реалм
- `include_children` (необязательный, по умолчанию false) - включать дочерние элементы
- `include_parents` (необязательный, по умолчанию false) - включать родительские элементы

**Примеры использования:**
```python
# Простой поиск по имени
search_templates("user")

# Поиск в конкретном реалме
search_templates("entity", realm_id="64da5fd6-474b-439b-bb37-be8072d3427b")

# Поиск с включением связанных элементов
search_templates("person", include_children=True, include_parents=True)
```

**Возвращает:**
- Форматированный список найденных шаблонов с UUID, именем и комментариями
- Сообщение об отсутствии результатов
- Информационные сообщения об ошибках

### 2. `list_available_realms`

Получение списка доступных реалмов (пространств) для пользователя.

**Параметры:** нет

**Примеры использования:**
```python
# Получить список всех доступных реалмов
list_available_realms()
```

**Возвращает:**
- Список реалмов с ID и именами
- Подсказку для использования realm ID в поиске шаблонов

## API интеграция

Инструменты используют Onto Core API:
- **Endpoint:** `POST /api/v2/core/realm/{realmId}/meta/find`
- **Аутентификация:** Bearer token (автоматически из текущей сессии)
- **Формат запроса:**
  ```json
  {
    "namePart": "search_term",
    "children": false,
    "parents": false
  }
  ```

## Обработка ошибок

Инструменты включают полную обработку ошибок:
- ✅ Автоматическое обновление токенов при истечении
- ✅ Понятные сообщения об ошибках аутентификации
- ✅ Обработка различных HTTP статусов (401, 403, 404)
- ✅ Валидация формата ответа API
- ✅ Graceful handling недоступных реалмов

## Особенности реализации

1. **Автоматический выбор реалма:** если realm_id не указан, используется первый доступный
2. **Безопасная обработка токенов:** автоматическая очистка non-ASCII символов
3. **Структурированный вывод:** красивое форматирование результатов с номерами и отступами
4. **Поддержка Unicode:** корректная работа с emoji и международными символами через safe_print

## Зависимости

- Требует аутентификации через существующую Keycloak систему
- Использует централизованные настройки из `onto_mcp.settings`
- Интегрируется с системой управления токенами

## Тестирование

Для тестирования функциональности используйте:
```bash
python test_templates.py          # Базовое тестирование
python test_personal_realm.py     # Тестирование в личном реалме
```

Убедитесь что переменные окружения настроены или используйте .env файл. 